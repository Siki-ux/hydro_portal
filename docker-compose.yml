services:
  hydro_portal:
    build:
      context: .
      dockerfile: Dockerfile
      target: runner
    container_name: hydro_portal
    ports:
      - "3001:3000"
    environment:
      # Use your VM Public IP or DNS Name here!
      - NEXT_PUBLIC_API_URL=http://localhost:8000/api/v1
      - NEXT_PUBLIC_GEOSERVER_URL=http://localhost:8080
      # Internal URL for container-to-container communication (fixes login issues)
      - INTERNAL_API_URL=http://api:8000/api/v1
      # Authentication Secrets (Required in Docker)
      - AUTH_SECRET=6e2e9c8b3a4f5d6e7f8g9h0i1j2k3l4m5n6o7p8q9r
      - NEXTAUTH_SECRET=6e2e9c8b3a4f5d6e7f8g9h0i1j2k3l4m5n6o7p8q9r
      - NEXTAUTH_URL=http://localhost:3001
      - AUTH_URL=http://localhost:3001/api/auth
      - AUTH_TRUST_HOST=true

    networks:
      - water-network

networks:
  water-network:
    external: true
    name: water_dp_water_dp_network
